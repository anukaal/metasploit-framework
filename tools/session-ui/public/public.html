<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">


    <!-- Title Page-->
    <title>Meterpreter WenView</title>

    <!-- Fontfaces CSS-->
    <link href="css/font-face.css" rel="stylesheet" media="all">
   
    <link href="resources/font-awesome-5/css/fontawesome-all.min.css" rel="stylesheet" media="all">
    <link href="resources/mdi-font/css/material-design-iconic-font.min.css" rel="stylesheet" media="all">

    <!-- Bootstrap CSS-->
    <link href="resources/bootstrap-4.1/bootstrap.min.css" rel="stylesheet" media="all">

    <!-- resources CSS-->
    <link href="resources/animsition/animsition.min.css" rel="stylesheet" media="all">
    <link href="resources/bootstrap-progressbar/bootstrap-progressbar-3.3.4.min.css" rel="stylesheet" media="all">
    
   <!-- <link href="resources/select2/select2.min.css" rel="stylesheet" media="all"> -->
    <link href="resources/perfect-scrollbar/perfect-scrollbar.css" rel="stylesheet" media="all">

    <!-- Main CSS-->
    <link href="css/theme.css" rel="stylesheet" media="all">
    <!-- Xterm CSS -->
    <link rel="stylesheet" href="resources/xterm/xterm.css" />
    
    <script src="resources/xterm/xterm.js" ></script>
    <script src="resources/xterm/addon/fit/fit.js" ></script>
    <script src="resources/xterm/addon/attach/attach.js" ></script>

       <!--
      <link rel="stylesheet" href="node_modules/xterm/dist/xterm.css" />
      <script src="node_modules/xterm/dist/xterm.js"></script> -->

</head>


<!-- Simple button to close terminal 

<button type="button" style="font-family: sans-serif; font-size: 12px; display: block; position: fixed; border: medium none; background: rgb(34, 136, 204) none repeat scroll 0% 0%; color: rgb(255, 255, 255); padding: 5px 15px; cursor: pointer; top: 0px; right: 0px; border-radius: 0px 0px 0px 5px;">Show Info</button>
 -->


<body class="animsition">
    <div class="page-wrapper">
        
        <!-- MENU SIDEBAR-->
        <aside class="menu-sidebar2">
            <div class="logo">
                <a href="http://127.0.0.1:3000/">
                   <!-- <img src="images/icon/logo.png" alt="Metasploit" /> -->
                </a>
            </div>
            <div class="menu-sidebar2__content js-scrollbar1">

                <nav class="navbar-sidebar2">
                    <ul class="list-unstyled navbar__list">
                        <li onclick="postModule(); this.onclick=null;" class="active has-sub">
                            <a class="js-arrow"  href="#">
                              <span class="arrow"><i class="fas fa-angle-down"></i>
                              </span>Post Modules
                            </a>
                            <ul id="post" class="list-unstyled navbar__sub-list js-sub-list">
                              <!-- Dynamic List here -->
                            </ul>
                          </li>

                        <li class="active has-sub">
                            <a class="js-arrow" onclick="ExtensionCommand(); this.onclick=null;" href="#">Extensions
                              <span class="arrow">
                                    <i class="fas fa-angle-down"></i>
                              </span>
                            </a>
                            
                            <ul id="exten" class="list-unstyled navbar__sub-list js-sub-list">
                              <!-- Dynamic List -->
                            </ul>
                        </li>

                        <li >
                          <a href="#">Commands</a>
                        </li>

                    </ul>
                </nav>
            </div>
        </aside>
        <!-- END MENU SIDEBAR-->

        <!-- PAGE CONTAINER-->
        <div class="page-container">
            <!-- HEADER DESKTOP-->
            <header class="header-desktop">
                <div class="section__content section__content--p30">
                    <div class="container-fluid">
                        <div class="header-wrap">
                            <div class="header-button">
                                <div class="account-wrap">
                                    <div class="account-item clearfix js-item-menu" align=right>
                                        <div class="content">
                                            <a class="js-acc-btn" onclick="sysinfo(); this.onclick=null; " href="#">System Information</a>
                                        </div>
                                        <div class="account-dropdown js-dropdown">
                                            <div class="info clearfix">
                                                <div class="content">
                                                    <h5 class="name">
                                                    <a href="#" id="sysname"></a>
                                                    </h5>
                                                    <span class="ip" id="ip"></span>
                                                </div>
                                            </div>
                                            <div class="account-dropdown__body">
                                                <div class="account-dropdown__item">
                                                 <a href="#" id="os" ></a>
                                                </div>
                                                <div class="account-dropdown__item">
                                                   <a href="#" id="getuid"></a>
                                                </div>
                                                <div class="account-dropdown__item">
                                              <a href="#" id="whoami"></a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            <!-- HEADER DESKTOP-->

            <!-- MAIN CONTENT-->
            <div class="main-content">
                <div class="section__content section__content--p30">
                    <div class="container-fluid">
                      <div class="row">
                        
                          <div class="mainsection" style="color: #ffffff !important; font-size: 18px !important">
                            <div id="terminal">
                                
                            </div>
      
                        </div>
                        
                      </div>
                    </div>
                </div>
            </div>
            <!-- END MAIN CONTENT-->
<script>
/* ************************ Implementing Wb Socket using Attach Addon*********************** */

        var textDecoder = new TextDecoder();
        var textEncoder = new TextEncoder();
        var terminal = document.getElementById('terminal');
        var wsUri = "";

        Terminal.applyAddon(attach);
        Terminal.applyAddon(fit);

//https://github.com/tsl0922/ttyd/blob/0b149bbbba69e2486b0561c0b952a7595eb7f90d/html/js/app.js#L182

var openWs= function(){
    var ws=new WebSocket(wsUri);
    var sendMessage = function (message) {
        if (ws.readyState === ws.OPEN) {
            ws.send(textEncoder.encode(message));
        }
    };


    var sendData = function (data) {
        sendMessage('0' + data);
    };

    var unloadCallback = function (event) {
        var message = 'Close terminal? this will also terminate the command.';
        (event || window.event).returnValue = message;
        return message;
    };
    /* To reset the terminal

    var resetTerm = function() {
        hideModal();
        clearTimeout(reconnectTimer);
        if (ws.readyState !== WebSocket.CLOSED) {
            ws.close();
        }
        openWs();
    };
                    */
    ws.binaryType = 'arraybuffer';

    ws.onopen = function (event) {
        console.log('Websocket connection opened');
        wsError = false;

        if (typeof term !== 'undefined') {
            term.dispose();
        }

        var term = new Terminal({
            cols: 145,
            rows: 31,
            fontSize: 15,
            fontFamily: '"Menlo for Powerline", Menlo, Consolas, "Liberation Mono", Courier, monospace',
            theme: {
                foreground: '#d2d2d2',
                background: '#000000',
                cursor: '#adadad',
                black: '#000000',
                red: '#d81e00',
                green: '#5ea702',
                yellow: '#cfae00',
                blue: '#427ab3',
                magenta: '#89658e',
                cyan: '#00a7aa',
                white: '#dbded8',
                brightBlack: '#686a66',
                brightRed: '#f54235',
                brightGreen: '#99e343',
                brightYellow: '#fdeb61',
                brightBlue: '#84b0d8',
                brightMagenta: '#bc94b7',
                brightCyan: '#37e6e8',
                brightWhite: '#f1f1f0'
            }
        });


        term.on('resize', function (size) {
            if (ws.readyState === WebSocket.OPEN) {
                sendMessage('1' + JSON.stringify({columns: size.cols, rows: size.rows}));
            }
            setTimeout(function () {
                term.showOverlay(size.cols + 'x' + size.rows);
            }, 500);
        });

        term.on('title', function (data) {
            if (data && data !== '') {
                document.title = (data + ' | ' + title);
            }
        });

        term.on('data', sendData);

        while (terminal.firstChild) {
            terminal.removeChild(terminal.firstChild);
        }

        window.addEventListener('resize', function() {
            clearTimeout(window.resizedFinished);
            window.resizedFinished = setTimeout(function () {
                term.fit();
            }, 250);
        });
        window.addEventListener('beforeunload', unloadCallback);

        term.open(terminal, true);
        term.fit();
        term.focus();
    };
    ws.onmessage = function(event) {
        var rawData = new Uint8Array(event.data),
            cmd = String.fromCharCode(rawData[0]),
            data = rawData.slice(1).buffer;
        switch(cmd) {
            case '0':
                title = textDecoder.decode(data);
                document.title = title;
                break;
            case '1':
                var preferences = JSON.parse(textDecoder.decode(data));
                Object.keys(preferences).forEach(function(key) {
                    console.log('Setting ' + key + ': ' +  preferences[key]);
                    term.setOption(key, preferences[key]);
                });
                break;
        }
    };

    ws.onclose = function(event) {
        console.log('Websocket connection closed with code: ' + event.code);
        if (term) {
            term.off('data');
            term.off('resize');
            if (!wsError) {
                term.showOverlay('Connection Closed', null);
            }
        }
        window.removeEventListener('beforeunload', unloadCallback);
        // 1000: CLOSE_NORMAL

    };




};


if (document.readyState === 'complete' || document.readyState !== 'loading') {
    openWs();
} else {
    document.addEventListener('DOMContentLoaded', openWs);
}


</script>

        <!-- END PAGE CONTAINER-->
        </div>

    </div>
    <!-- Jquery JS-->
    <script src="resources/jquery-3.2.1.min.js"></script> 
    <!-- Xterm Js--> 
    
    <!-- Bootstrap JS-->
    <!-- <script src="resources/bootstrap-4.1/popper.min.js"></script> 
    <script src="resources/bootstrap-4.1/bootstrap.min.js"></script>-->
    <!-- resources JS       -->
    
    <script src="resources/animsition/animsition.min.js"></script>
    <script src="resources/bootstrap-progressbar/bootstrap-progressbar.min.js">
    </script>

    <script src="resources/perfect-scrollbar/perfect-scrollbar.js"></script>
  <!--  <script src="resources/select2/select2.min.js"> 
    </script>-->

    <!-- Main JS-->
    <script src="js/load.js"></script>
    <script src="js/main.js"></script>


</body>

</html>
<!-- end document-->









